<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>شركة دجلة للصناعات الدوائية — كتالوج الطلب</title>
  <style>
    :root{--blue:#0b63b3;--light:#f7fbff;--card:#ffffff;--muted:#6b7280}
    *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    body{margin:0;background:linear-gradient(180deg,#f5f9ff 0%,#ffffff 100%);color:#0b1720}
    header{background:var(--blue);color:white;padding:18px 16px;display:flex;align-items:center;gap:12px}
    .brand{font-size:18px;font-weight:700}
    .subtitle{font-size:13px;opacity:.95}
    .container{max-width:980px;margin:20px auto;padding:0 16px}
    
    /* حقل العروض البسيط */
    .offer-banner{background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:white;padding:15px 20px;border-radius:12px;margin-bottom:25px;text-align:center;box-shadow:0 4px 15px rgba(255,107,107,0.3);border:2px solid #ff9f43;}
    .offer-title{font-size:20px;font-weight:800;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:10px;}
    .offer-content{font-size:16px;line-height:1.5;font-weight:500;}
    .offer-icon{font-size:24px;}
    
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(11,99,179,0.08);display:flex;flex-direction:column;align-items:center;text-align:center;cursor:pointer;transition:transform 0.2s ease;}
    .card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(11,99,179,0.12)}
    .card img{width:130px;height:130px;object-fit:contain;border-radius:8px;background:#fff;padding:6px;border:1px solid #f0f0f0;}
    .name{font-weight:700;margin-top:10px;font-size:15px;}
    .type{font-size:13px;color:var(--muted);margin-top:6px;min-height:36px;}
    .price{margin-top:8px;font-weight:700;color:var(--blue);font-size:14px;}
    .qty{margin-top:12px;display:flex;align-items:center;gap:8px}
    .btn{background:var(--blue);color:#fff;border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;width:100%;}
    .qty button{width:36px;height:36px;border-radius:8px;border:1px solid #e6eefb;background:white;cursor:pointer;font-weight:bold;}
    .qty input{width:56px;text-align:center;border:1px solid #e6eefb;border-radius:8px;padding:8px;font-size:14px;}
    footer{position:fixed;left:0;right:0;bottom:0;background:#fff;padding:12px;border-top:1px solid #eef3fb;display:flex;flex-direction:column;align-items:center;gap:10px}
    .summary{display:flex;flex-direction:column;align-items:center;gap:4px}
    .total{font-weight:800;font-size:18px;color:var(--blue)}
    form{display:flex;flex-direction:column;gap:8px;width:100%;max-width:400px;padding:8px}
    input,textarea,select{border:1px solid #e6eefb;border-radius:8px;padding:8px;width:100%;font-size:14px}
    textarea{resize:none;height:60px}
    .loading{text-align:center;padding:20px;color:var(--muted)}
    
    /* نمط البطاقة الموسعة */
    .overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px;}
    .expanded-card{background:white;border-radius:20px;padding:30px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto;position:relative;text-align:center;}
    .close-btn{position:absolute;top:15px;left:15px;background:none;border:none;font-size:24px;cursor:pointer;color:#666;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;}
    .close-btn:hover{background:#f5f5f5;}
    .expanded-image{width:200px;height:200px;object-fit:contain;margin-bottom:20px;}
    .expanded-name{font-size:24px;font-weight:700;color:#333;margin-bottom:10px;}
    .expanded-type{font-size:16px;color:var(--muted);margin-bottom:15px;}
    .expanded-price{font-size:20px;font-weight:700;color:var(--blue);margin-bottom:20px;}
    .expanded-qty{display:flex;align-items:center;justify-content:center;gap:15px;margin:25px 0;}
    .expanded-qty button{width:50px;height:50px;border-radius:12px;border:2px solid #e6eefb;background:white;cursor:pointer;font-size:20px;font-weight:bold;}
    .expanded-qty input{width:80px;height:50px;text-align:center;border:2px solid #e6eefb;border-radius:12px;font-size:18px;font-weight:bold;}
    .add-to-cart{background:var(--blue);color:white;border:none;padding:15px 30px;border-radius:12px;font-size:18px;font-weight:700;cursor:pointer;margin-top:10px;width:100%;}
    .add-to-cart:hover{background:#0a5aa3;}
    
    @media(max-width:520px){
      .card img{width:110px;height:110px}
      .expanded-card{padding:20px;}
      .expanded-image{width:150px;height:150px;}
      .expanded-name{font-size:20px;}
      .offer-title{font-size:18px;}
      .offer-content{font-size:14px;}
    }
  </style>
</head>
<body>
  <header>
    <div>
      <div class="brand">شركة دجلة للصناعات الدوائية/محافظة الديوانية</div>
      <div class="subtitle">اطلب عبر واتساب بسرعة وسهولة</div>
    </div>
  </header>

  <main class="container">
    <!-- حقل العروض البسيط -->
    <div class="offer-banner" id="offerBanner">
      <div class="offer-title">
        <span class="offer-icon">🎁</span>
        العروض الحالية
      </div>
      <div class="offer-content" id="offerContent">
        <!-- سيتم تعبئة النص هنا -->
      </div>
    </div>

    <div class="loading" id="loading">جاري تحميل المنتجات...</div>
    <section class="grid" id="products"></section>
  </main>

  <!-- البطاقة الموسعة -->
  <div class="overlay" id="overlay">
    <div class="expanded-card" id="expandedCard">
      <button class="close-btn" id="closeBtn">×</button>
      <img class="expanded-image" id="expandedImage" src="" alt="">
      <div class="expanded-name" id="expandedName"></div>
      <div class="expanded-type" id="expandedType"></div>
      <div class="expanded-price" id="expandedPrice"></div>
      <div class="expanded-qty">
        <button class="dec-expanded">−</button>
        <input type="number" min="0" value="0" class="count-expanded" id="expandedCount">
        <button class="inc-expanded">+</button>
      </div>
      <button class="add-to-cart" id="addToCart">إضافة إلى الطلب</button>
    </div>
  </div>

  <footer>
    <div class="summary">
      <div>إجمالي الطلب</div>
      <div class="total" id="total">0 د.ع</div>
    </div>

    <form id="customer-info">
      <input type="text" id="custName" placeholder="اسم الصيدلية " required>
      <input type="tel" id="custPhone" placeholder="رقم الهاتف" required>
      <input type="text" id="custAddress" placeholder="العنوان" />
      <textarea id="custNotes" placeholder="ملاحظات التجهيز (اسم المذخر)"></textarea>
      <button type="button" class="btn" id="send">إرسال الطلب عبر واتساب</button>
    </form>
  </footer>

  <script>
    const WHATSAPP_NUMBER = '9647812374712';
    let currentExpandedCard = null;
    
    // نص العرض الحالي - يمكنك تعديل هذا النص بسهولة
    const currentOfferText = "عرض الكوتا الذهبية: استثمارك ينمو 10 أضعاف استغل الآن... وفّر أكثر\n\nعندما يصل إجمالي قيمة طلبية الشراء الواحدة من الأدوية إلى مليون دينار عراقي، ستحصل فورًا على أدوية إضافية مجانية بقيمة لا تقل عن 10% من قيمة مشترياتك\n\nبمعنى آخر على كل مليون دينار تنفقه، تحصل على ما قيمته 100,000 دينار من الأدوية مجانًا. هذا ليس مجرد خصم، بل هو زيادة فعلية في مخزونك وأرباحك";

    // دالة لعرض نص العرض
    function loadOffer() {
      const offerContent = document.getElementById('offerContent');
      offerContent.textContent = currentOfferText;
      
      // إخفاء البانر إذا لم يكن هناك عرض
      if (!currentOfferText || currentOfferText.trim() === '') {
        document.getElementById('offerBanner').style.display = 'none';
      }
    }

    // دالة لتحويل الامتداد من .img إلى .jpg
    function convertImageExtension(imageName) {
      return imageName.replace('.img', '.jpg').replace('.IMG', '.jpg');
    }

    async function loadProducts() {
      const container = document.getElementById('products');
      const loading = document.getElementById('loading');
      
      let products = [];
      
      try {
        const response = await fetch('products.json');
        products = await response.json();
      } catch (err) {
        products = [];
        console.error('فشل تحميل المنتجات');
      }
      
      container.innerHTML = '';
      
      if (products.length === 0) {
        loading.textContent = 'لا توجد منتجات متاحة';
        return;
      }
      
      for (let i = 0; i < products.length; i++) {
        const item = products[i];
        const correctedImageName = convertImageExtension(item.image);
        const imageUrl = `images/${correctedImageName}`;
        
        const card = document.createElement('article');
        card.className = 'card';
        card.dataset.id = i + 1;
        card.dataset.name = item.name;
        card.dataset.type = item.type;
        card.dataset.price = item.price;
        card.dataset.image = imageUrl;
        
        const placeholderImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9Ijc1IiB5PSI3NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSIjOTk5Ij7Yp9mE2LXZiNix2Kkg2LrZitixINmF2KrZiNmB2LHYqTwvdGV4dD48L3N2Zz4=';
        
        card.innerHTML = `
          <img src="${imageUrl}" alt="${item.name}" 
               onerror="this.src='${placeholderImage}'" />
          <div class="name">${item.name}</div>
          <div class="type">${item.type}</div>
          <div class="price">سعر القطعة: <span>${formatCurrency(item.price)}</span> د.ع</div>
          <div class="qty">
            <button class="dec">−</button>
            <input type="number" min="0" value="0" class="count" />
            <button class="inc">+</button>
          </div>`;
        container.appendChild(card);
      }
      
      loading.style.display = 'none';
      attachEvents();
      recalc();
    }

    function formatCurrency(n){return n.toLocaleString('en-US');}

    // دالة لعرض البطاقة الموسعة
    function expandCard(card) {
      const overlay = document.getElementById('overlay');
      const expandedImage = document.getElementById('expandedImage');
      const expandedName = document.getElementById('expandedName');
      const expandedType = document.getElementById('expandedType');
      const expandedPrice = document.getElementById('expandedPrice');
      const expandedCount = document.getElementById('expandedCount');
      
      const name = card.dataset.name;
      const type = card.dataset.type;
      const price = card.dataset.price;
      const image = card.dataset.image;
      const currentQty = card.querySelector('.count').value;
      
      expandedImage.src = image;
      expandedName.textContent = name;
      expandedType.textContent = type;
      expandedPrice.textContent = `سعر القطعة: ${formatCurrency(price)} د.ع`;
      expandedCount.value = currentQty;
      
      currentExpandedCard = card;
      overlay.style.display = 'flex';
      
      const incExpanded = document.querySelector('.inc-expanded');
      const decExpanded = document.querySelector('.dec-expanded');
      
      incExpanded.onclick = () => {
        expandedCount.value = Math.max(0, Number(expandedCount.value || 0) + 1);
      };
      
      decExpanded.onclick = () => {
        expandedCount.value = Math.max(0, Number(expandedCount.value || 0) - 1);
      };
      
      expandedCount.onchange = () => {
        if (Number(expandedCount.value) < 0) expandedCount.value = 0;
      };
    }

    function closeExpandedCard() {
      const overlay = document.getElementById('overlay');
      overlay.style.display = 'none';
      currentExpandedCard = null;
    }

    function addToCartFromExpanded() {
      if (currentExpandedCard) {
        const expandedCount = document.getElementById('expandedCount');
        const originalInput = currentExpandedCard.querySelector('.count');
        originalInput.value = expandedCount.value;
        recalc();
        closeExpandedCard();
      }
    }

    function attachEvents(){
      const cards = document.querySelectorAll('.card');
      const closeBtn = document.getElementById('closeBtn');
      const overlay = document.getElementById('overlay');
      const addToCartBtn = document.getElementById('addToCart');
      
      cards.forEach(card => {
        card.addEventListener('click', (e) => {
          if (!e.target.classList.contains('dec') && 
              !e.target.classList.contains('inc') && 
              !e.target.classList.contains('count')) {
            expandCard(card);
          }
        });
        
        const inc = card.querySelector('.inc');
        const dec = card.querySelector('.dec');
        const input = card.querySelector('.count');
        
        inc.addEventListener('click', (e) => {
          e.stopPropagation();
          input.value = Math.max(0, Number(input.value || 0) + 1);
          recalc();
        });
        
        dec.addEventListener('click', (e) => {
          e.stopPropagation();
          input.value = Math.max(0, Number(input.value || 0) - 1);
          recalc();
        });
        
        input.addEventListener('change', () => {
          if (Number(input.value) < 0) input.value = 0;
          recalc();
        });
        
        input.addEventListener('input', () => {
          if (Number(input.value) < 0) input.value = 0;
          recalc();
        });
      });
      
      closeBtn.addEventListener('click', closeExpandedCard);
      addToCartBtn.addEventListener('click', addToCartFromExpanded);
      
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeExpandedCard();
        }
      });
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && overlay.style.display === 'flex') {
          closeExpandedCard();
        }
      });
    }

    function recalc(){
      let total=0;
      document.querySelectorAll('.card').forEach(card=>{
        const price=Number(card.dataset.price);
        const qty=Number(card.querySelector('.count').value||0);
        total+=price*qty;
      });
      document.getElementById('total').textContent=total===0?'0 د.ع':formatCurrency(total)+' د.ع';
      return total;
    }

    document.getElementById('send').addEventListener('click',()=>{
      const name=document.getElementById('custName').value.trim();
      const phone=document.getElementById('custPhone').value.trim();
      const address=document.getElementById('custAddress').value.trim();
      const notes=document.getElementById('custNotes').value.trim();

      // التحقق من صحة رقم الهاتف
      if(!/^(\+?964|0)?7[0-9]{9}$/.test(phone.replace(/\s/g, ''))) {
        alert('الرجاء إدخال رقم هاتف عراقي صحيح');
        return;
      }

      // التحقق من اسم الصيدلية
      if(name.length < 3) {
        alert('الرجاء إدخال اسم صيدلية صحيح');
        return;
      }

      const items=[];let total=0;
      document.querySelectorAll('.card').forEach(card=>{
        const n=card.dataset.name;
        const t=card.dataset.type;
        const p=Number(card.dataset.price);
        const q=Number(card.querySelector('.count').value||0);
        if(q>0){
          items.push({n,t,p,q});
          total+=p*q;
        }
      });

      if(items.length===0){
        alert('لم يتم إضافة أي منتجات للطلب. الرجاء اختيار المنتجات وتحديد الكميات المطلوبة قبل إرسال الطلب.');
        return;
      }
      if(!name||!phone){
        alert('الرجاء إدخال الاسم ورقم الهاتف.');
        return;
      }

      let msg='طلب من شركة دجلة للصناعات الدوائية%0A';
      msg+='------------------------------%0A';
      msg+='ت  |  المادة  |  النوع  |  الكمية  |  السعر  |  الإجمالي%0A';
      msg+='------------------------------%0A';
      items.forEach((it, index)=>{
        msg+=`${index + 1}  |  ${it.n}  |  ${it.t}  |  ${it.q}  |  ${formatCurrency(it.p)}  |  ${formatCurrency(it.p * it.q)} د.ع%0A`;
      });
      msg+='------------------------------%0A';
      msg+=`الإجمالي الكلي: ${formatCurrency(total)} د.ع%0A%0A`;
      msg+=`معلومات العميل:%0A`;
      msg+=`الاسم: ${name}%0A`;
      msg+=`رقم الهاتف: ${phone}%0A`;
      msg+=`العنوان: ${address||'—'}%0A`;
      if(notes) msg+=`ملاحظات: ${notes}%0A`;
      msg+='%0Aشكراً لتعاملكم مع شركة دجلة للصناعات الدوائية';

      // إرسال الطلب
      const waLink=`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
      window.open(waLink,'_blank');

      // إرسال رسالة الشكر بعد ثواني قليلة
      setTimeout(() => {
        const thankMsg = 
`عزيزنا الصيدلي المحترم ${name}،
نود أن نعبر عن خالص شكرنا وامتناننا لثقتكم الغالية في شركة دجلة للصناعات الدوائية.

نؤكد لكم أن طلبكم محل اهتمامنا وسيتم التعامل معه بأقصى درجات العناية والمهنية. سيقوم فريقنا بتجهيز طلبكم وإيصاله في أسرع وقت ممكن.

نحن نفخر بخدمتكم ونتطلع دائماً لتقديم أفضل المنتجات وأجود الخدمات لكم.

معاً نحو صناعة دوائية عراقية متطورة 🌟
فريق خدمة العملاء - شركة دجلة للصناعات الدوائية
مندوب: محافظة الديوانية`;

        const thanksLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(thankMsg)}`;
        window.open(thanksLink,'_blank');
      }, 3000); // إرسال بعد 3 ثواني
    });

    // تحميل العرض والمنتجات عند بدء التشغيل
    loadOffer();
    loadProducts();
  </script>
</body>
</html>
